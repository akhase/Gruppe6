---
title: "Datenaufbereitung"
output: html_notebook
---

- Achsenbeschriftungen
- cor wieso negative Werte?

```{r}
library(readr)
library(VIM)
library(dplyr)
library(tidyr)

#df_all <- VIM::df_all

# Zeilen löschen an denen Warengruppe und Umsatz NA ist
df_all_short <- df_all[complete.cases(df_all$Warengruppe),]

#sum(is.na(df_all_short$Warengruppe))
#sum(is.na(df_hotdeck1$Umsatz))
#sum(is.na(df_hotdeck1$Schulferien))
#sum(is.na(df_hotdeck1$Ferientag))

#
df_all_short %>% aggr(combined=TRUE, numbers=TRUE, plot = TRUE)

# löschen der Zeilen, wenn NA vorkommt, um zu sehen was nicht passt
df_all_deletion <- na.omit(df_all)
df_all_deletion %>% aggr(combined=TRUE, numbers=TRUE)


# VIM Hot-Deck Imputation
#df_wettercode <- df_all[,c("Datum","Wettercode", "Temperatur", "Windgeschwindigkeit", "Bewoelkung")]

df_hotdeck1 <- hotdeck(df_all_short, variable = "Wettercode", domain_var = c("Temperatur"), impNA = TRUE)
df_hotdeck1 <- hotdeck(df_hotdeck1, variable = "Wettercode", domain_var = c("Windgeschwindigkeit"), impNA = TRUE)
df_hotdeck1 <- hotdeck(df_hotdeck1, variable = "Wettercode", domain_var = c("Bewoelkung"), impNA = TRUE)
df_hotdeck1 %>% aggr(combined=TRUE, numbers=TRUE)

df_hotdeck2 <- hotdeck(df_hotdeck1, variable = "Bewoelkung", domain_var = c("Wettercode"), impNA = TRUE)
df_hotdeck2 %>% aggr(combined=TRUE, numbers=TRUE)

#check, ob alle NAs ersetzt worden sind
sum(is.na(df_hotdeck2$Bewoelkung))

#ggplot(df_hotdeck1) +
#  geom_point(aes(x=Warengruppe, y=Umsatz, color=Wettercode_imp))

#unnötige true false spalten löschen
df_drop <- df_hotdeck2 %>% select(-(Wettercode_imp: Wettercode_imp.2))
df_drop <- df_drop %>% select(-(Bewoelkung_imp))

sum(is.na(df_drop$Bewoelkung))

names(df_drop)[5] <- "Bewoelkung_imp"
names(df_drop)[8] <- "Wettercode_imp"

View(df_drop)
sum(is.na(df_drop$Bewoelkung))

df_all_short <- df_all_short %>% select(-(Datum))
str(df_all_short)


# VIM Iterative Robust Model Imputation (IRMI)
df_irmi <- irmi(df_all_short)

aggr(df_irmi, delimiter ="_imp" )

df_irmi <- irmi(df_all_short)
ggplot(df_irmi) +
  geom_point(aes(x=Bewoelkung, y=Umsatz, color=Bewoelkung_imp))


# Impact
cor(df_all_deletion$Umsatz, df_all_deletion$Bewoelkung)
cor(df_hotdeck1$Umsatz, df_hotdeck1$Bewoelkung, use = "complete.obs")
cor(df_hotdeck2$Umsatz, df_hotdeck2$Bewoelkung, use = "complete.obs")
cor(df_irmi$Umsatz, df_irmi$Bewoelkung)

```



