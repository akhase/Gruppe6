---
title: "Datenvorbereitung neuronales Netz"
output: html_notebook
---


```{r}
###################################################
### Preparation of the Environment ####

# Clear environment
#remove(list = ls())

# Create list with needed libraries
#pkgs <- c("readr", "fastDummies", "reticulate", "ggplot2", "Metrics")

pkgs <- c("readr", "fastDummies", "reticulate", "ggplot2", "Metrics")

# Load each listed library and check if it is installed and install if necessary
for (pkg in pkgs) {
  if (!require(pkg, character.only = TRUE)) {
    install.packages(pkg)
    library(pkg, character.only = TRUE)
  }
}


###################################################
### Data Import ####

# Reading the data file
umsatz_vorbereitung <- df_drop
names(umsatz_vorbereitung)

###################################################
### Data Preparation ####

# Recoding of the variables into one-hot -> 0 1 encoded (dummy -> ja nein/ 1 0 Variablen) variables
#dummy_list <- c("view", "condition")
#house_pricing_dummy = dummy_cols(house_pricing, dummy_list)
#names(house_pricing_dummy)

dummy_list <- c("Warengruppe", "Bewoelkung_imp")
umsatz_vorbereitung_dummy = dummy_cols(df_drop,dummy_list)
names(umsatz_vorbereitung_dummy)

# Definition of lists for each one-hot encoded variable (just to make the handling easier)
warengruppe_dummies = c('Warengruppe_1', 'Warengruppe_2', 'Warengruppe_3', 'Warengruppe_4', 'Warengruppe_5', 'Warengruppe_6')
bewoelkung_dummies = c('Bewoelkung_0', 'Bewoelkung_1', 'Bewoelkung_2', 'Bewoelkung_3','Bewoelkung_4','Bewoelkung_5','Bewoelkung_6','Bewoelkung_7','Bewoelkung_8')

str(umsatz_vorbereitung_dummy)
###################################################
### Selection of the Feature Variables and the Label Variable ####

# Selection of the features (the independent variables used to predict the dependent)
#features <- c('sqft_lot', 'waterfront', 'grade', 'bathrooms', view_dummies, condition_dummies)
#das was man reingibt
#features <- c('sqft_lot', 'waterfront', 'grade', 'bathrooms', condition_dummies, view_dummies)
# Selection of the label (the dependent variable)
#das was man vorhersagen will
#labels <- 'price'

features <- c('Datum','Warengruppe','KielerWoche','Temperatur','Windgeschwindigkeit','Wettercode_imp','Feiertage','Schulferien','Bewoelkung_imp')
labels <- 'Umsatz'

###################################################
### Selection of Training, Validation and Test Data ####

# Look at the data
#str(house_pricing_dummy)

str(umsatz_vorbereitung_dummy)

# Setting the random counter to a fixed value, so the random initialization stays the same (the random split is always the same)
set.seed(1)

# Shuffling the dataset (to get a random order)
new_row_order <- sample(nrow(umsatz_vorbereitung_dummy))
umsatz_vorbereitung_dummy <- umsatz_vorbereitung_dummy[new_row_order, ]

# Assign each row number in the full dataset randomly to one of the three groups of datasets
# The probability of being in one of the groups results then in corresponding group sizes
# nrow gibt ZeilenlÃ¤nge an
assignment <- sample(1:3, size = nrow(umsatz_vorbereitung_dummy), prob = c(.7, .2, .1), replace = TRUE)
#dt_dummy <- as.data.table(umsatz_vorbereitung_dummy)
# Create training, validation and test data for the features and the labels
training_features <- umsatz_vorbereitung_dummy[assignment == 1, features]    # subset umsatz_vorbereitung_dummy to training indices only
training_labels <- umsatz_vorbereitung_dummy[assignment == 1, labels]    # subset umsatz_vorbereitung_dummy to training indices only

validation_features <- umsatz_vorbereitung_dummy[assignment == 2, features]  # subset umsatz_vorbereitung_dummy to validation indices only
validation_labels <- umsatz_vorbereitung_dummy[assignment == 2, labels]  # subset umsatz_vorbereitung_dummy to validation indices only

test_features <- umsatz_vorbereitung_dummy[assignment == 3, features]   # subset umsatz_vorbereitung_dummy to test indices only
test_labels <- umsatz_vorbereitung_dummy[assignment == 3, labels]   # subset umsatz_vorbereitung_dummy to test indices only

```
