---
title: "Datenvorbereitung neuronales Netz"
output: html_notebook
---
- na s in sonnig, temperatur eliminiert

```{r}
###################################################
### Preparation of the Environment ####

# Clear environment
#remove(list = ls())

# Create list with needed libraries
#pkgs <- c("readr", "fastDummies", "reticulate", "ggplot2", "Metrics")

pkgs <- c("readr", "fastDummies", "reticulate", "ggplot2", "Metrics")

# Load each listed library and check if it is installed and install if necessary
for (pkg in pkgs) {
  if (!require(pkg, character.only = TRUE)) {
    install.packages(pkg)
    library(pkg, character.only = TRUE)
  }
}


###################################################
### Data Import ####

# Reading the data file
umsatz_vorbereitung <- df_drop

#variablen löschen, die wir nicht mehr haben wollen

umsatz_vorbereitung$Umsatz <- round(umsatz_vorbereitung$Umsatz)
umsatz_vorbereitung$Temperatur <- round(umsatz_vorbereitung$Temperatur)

View(umsatz_vorbereitung)
str(umsatz_vorbereitung)
names(umsatz_vorbereitung)

sum(is.na(umsatz_vorbereitung$Warengruppe))
sum(is.na(umsatz_vorbereitung$Umsatz))
sum(is.na(umsatz_vorbereitung$Bewoelkung_imp))
sum(is.na(umsatz_vorbereitung$Temperatur))
sum(is.na(umsatz_vorbereitung$Wettercode_imp))
sum(is.na(umsatz_vorbereitung$Feiertage))
sum(is.na(umsatz_vorbereitung$Schulferien))
sum(is.na(umsatz_vorbereitung$Sonnig))

###################################################
### Data Preparation ####

dummy_list <- c("Warengruppe", "Bewoelkung_imp")
umsatz_vorbereitung_dummy = dummy_cols(umsatz_vorbereitung,dummy_list)
names(umsatz_vorbereitung_dummy)

# Definition of lists for each one-hot encoded variable (just to make the handling easier)
warengruppe_dummies = c('Warengruppe_1', 'Warengruppe_2', 'Warengruppe_3', 'Warengruppe_4', 'Warengruppe_5', 'Warengruppe_6')
bewoelkung_dummies = c('Bewoelkung_0', 'Bewoelkung_1', 'Bewoelkung_2', 'Bewoelkung_3','Bewoelkung_4','Bewoelkung_5','Bewoelkung_6','Bewoelkung_7','Bewoelkung_8')

###################################################
### Selection of the Feature Variables and the Label Variable ####

features <- c('Warengruppe','Temperatur','Wettercode_imp','Feiertage','Schulferien','Bewoelkung_imp','Sonnig_imp')
labels <- 'Umsatz'

###################################################
### Selection of Training, Validation and Test Data ####

# Setting the random counter to a fixed value, so the random initialization stays the same (the random split is always the same)
set.seed(1)

# Shuffling the dataset (to get a random order)
new_row_order <- sample(nrow(umsatz_vorbereitung_dummy))
umsatz_vorbereitung_dummy <- umsatz_vorbereitung_dummy[new_row_order, ]

# Assign each row number in the full dataset randomly to one of the three groups of datasets
# The probability of being in one of the groups results then in corresponding group sizes
# nrow gibt Zeilenlänge an
assignment <- sample(1:3, size = nrow(umsatz_vorbereitung_dummy), prob = c(.7, .2, .1), replace = TRUE)
#dt_dummy <- as.data.table(umsatz_vorbereitung_dummy)
# Create training, validation and test data for the features and the labels
training_features <- umsatz_vorbereitung_dummy[assignment == 1, features]    # subset umsatz_vorbereitung_dummy to training indices only
training_labels <- umsatz_vorbereitung_dummy[assignment == 1, labels]    # subset umsatz_vorbereitung_dummy to training indices only

validation_features <- umsatz_vorbereitung_dummy[assignment == 2, features]  # subset umsatz_vorbereitung_dummy to validation indices only
validation_labels <- umsatz_vorbereitung_dummy[assignment == 2, labels]  # subset umsatz_vorbereitung_dummy to validation indices only

test_features <- umsatz_vorbereitung_dummy[assignment == 3, features]   # subset umsatz_vorbereitung_dummy to test indices only
test_labels <- umsatz_vorbereitung_dummy[assignment == 3, labels]   # subset umsatz_vorbereitung_dummy to test indices only


```
